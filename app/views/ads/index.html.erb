
<% provide(:title, 'All Ads') %>
<h1>All Ads</h1>
<%if current_user.role != 'admin' %>
  <%= will_paginate %>

  <ul class="users">
    <%= render @ads %>
  </ul>

  <%= will_paginate %>
<%else%>
  <% if @ads.where(stage: "pending").size > 0 %>
    <%= form_with url: update_multiple_ads_url, method: :patch do %>

      <h1>Pending</h1>
      <table class="table">
        <thead class="thead-dark">
          <tr>
            <th data-sort-ignore="true">Choose</th>
            <th>Title</th>
            <th>Author</th>
            <th>Status</th>
            <th>More...</th>
          </tr>
        </thead>
        <tbody>
          <%@ads.where(stage: "pending").each do |ad| %>
            <tr>
              <td>
                <%= check_box_tag  "ad_ids[]", ad.id, false, class: 'selectable' %>
              </td>
              <td>
                <%= ad.name%>
              </td>
              <td>
                <%= ad.user.name %>
              </td>
              <td>
                <%= ad.stage %>
              </td>
              <td>
                <%= link_to "More...", ad%>
              </td>
            </tr>
          <%end%>
        </tbody>
      </table>

      <div id="reject_modal-window" class="modal" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title" id="myModalLabel">Reason for rejection:</h4>
              <button type="button" class="close" data-dismiss="modal">x</button>
            </div>
            <div class="modal-body">
              <%=hidden_field_tag :stage, :rejected %>
              <%= text_field_tag 'reason' %>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary">Rejected</button>
            </div>
          </div>
        </div>
      </div>

      <div style="display:flex; text-align: center; justify-content: center;"
        <%= link_to 'Approve', approve_multiple_ads_path,  {:remote => true, 'data-toggle' =>  "modal", 'data-target' => '#approve_modal-window', class: 'btn btn-primary btn-lg'}  %>
        <%= link_to 'Reject', reject_multiple_ads_path,  {:remote => true, 'data-toggle' =>  "modal", 'data-target' => '#reject_modal-window', class: 'btn btn-primary btn-lg'}  %>
      </div>

      <div id="approve_modal-window" class="modal" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title" id="myModalLabel">Choose tag:</h4>
              <button type="button" class="close" data-dismiss="modal">x</button>
            </div>
            <div class="modal-body">
              <%=select :name, :tag_id, Tag.all.collect { |t| [ t.name, t.id ] }, { include_blank: false }%>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary">Approve</button>
            </div>
          </div>
        </div>
      </div>

    <%end%>
  <%end%>

  <% if @ads.where(stage: "published").size > 0 %>
    <%= form_with url: destroy_multiple_ads_path, method: :delete do %>

      <h1 style='margin-top: 20px'>Published</h1>
      <table class="table">
        <thead class="thead-dark">
          <tr>
            <th data-sort-ignore="true">
              Choose
            </th>
            <th>Title</th>
            <th>Author</th>
            <th>Status</th>
            <th>More...</th>
          </tr>
        </thead>
        <tbody>
          <%@ads.where(stage: "published").each do |ad| %>
            <tr>
              <td>
                <%= check_box_tag  "ad_ids[]",ad.id, false, class: 'selectable' %>
              </td>
              <td>
                <%= ad.name%>
              </td>
              <td>
                <%= ad.user.name %>
              </td>
              <td>
                <%= ad.stage %>
              </td>
              <td>
                <%= link_to "More...", ad%>
              </td>
            </tr>
          <%end%>
        </tbody>
      </table>
      <div style="display:flex; text-align: center; justify-content: center;">
        <%= submit_tag "Delete selected", class: "btn btn-primary" %>
      </div>
    <%end%>
  <%end%>
<%end %>